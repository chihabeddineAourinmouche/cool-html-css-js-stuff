<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fun</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Verdana, Geneva, Tahoma, sans-serif;
        }

        body {
            width: 100dvw;
            height: 100dvh;
            background-color: hsl(0, 30%, 50%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 50px;
            user-select: none;
            transition: background-color .2s ease-in-out;
        }

        .container {
            background-color: rgba(255, 255, 255, .1);
            min-width: 360px;
            min-height: 360px;
            border-radius: 38px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            color: #ffffff;
            font-size: 2em;
            cursor: grab;
        }

        .image__viewer__container {
            width: 250px;
            height: 250px;
            color: #001122;
            display: flex;
            align-items: center;
            border-radius: 38px;
            overflow: hidden;
        }

        .image__viewer {
            width: 100%;
            height: 100%;
            background-size: 100%;
            flex-shrink: 0;
            transition: transform .2s ease-in-out;
        }
    </style>
</head>

<body>
    <!-- STATE -->
    <script>
        /*
            SET UP A STATE WITH
            - idx: INDEX OF THE CURRENT FRAME
            - zoom: ZOOM LEVEL. DEFAULTS TO 1
            - images: AN ARRAY OF IMAGE PATHS
        */
        const state = { idx: 0, zoom: 1, images: [] }
        for (let i = 1; i < 330; i++) state.images.push(`./images/${i}.png`)
    </script>

    <!-- COMPONENT CONTAINER -->
    <script>
        /*
            THE ELEMENT CONTAINING THE IMAGE VIEWER.
            CONTAINER LISTENS TO MOUSE EVENTS AND CONTROLS THE STATE.
        */
        const Container = (parent) => {
            // CREATE AND ADD CONTAINER TO THE DOM
            const container = document.createElement("div")
            container.classList.add("container")
            parent.appendChild(container)
            // LISTEN TO EVENTS
            container.addEventListener("mousemove", (event) => {
                if (event.buttons === 1) {// ONLY WHILE THE PRIMARY MOUSE BUTTON IS PRESSED
                    const imgRect = container.getBoundingClientRect()
                    // HORIZONTAL (ROTATION)
                    /*
                        CAPTURE POSITION OF THE CURSOR WITHIN THE CONTAINER
                        AND SET THE STATE'S INDEX ACCORDINGLY.
                        USE THE INDEX TO SET THE CURRENT FRAME'S IMAGE.
                        ALSO USE THE INDEX TO SET THE BACKGROUND HUE OF THE BODY.
                    */
                    const mouseX = event.clientX - imgRect.left
                    const totalWidth = imgRect.width
                    const imageIndex = Math.floor((mouseX / totalWidth) * state.images.length)
                    if (imageIndex > 0 && imageIndex < state.images.length && imageIndex !== state.idx) {
                        state.idx = imageIndex
                        const hue = imageIndex * 200 / state.images.length
                        document.body.style.backgroundColor = `hsl(${hue}, 30%, 50%)`
                    }
                    // VERTICAL (ZOOM)
                    /*
                        WHEN THE MOUSE GOES ABOVE THE MIDDLE HORIZONTAL LINE,
                        SET THE STATE'S ZOOM TO A ZOOMED IN STATE. OTHERWISE,
                        SET THE STATE'S ZOOM TO A DEFAULT STATE.
                    */
                    const mouseY = event.clientY - imgRect.top
                    const totalHeight = imgRect.height
                    if (mouseY < totalHeight / 2) {
                        state.zoom = 2
                    } else {
                        state.zoom = 1
                    }
                    // DISPATCH EVENT TO RESET THE IMAGE VIEWER CONTAINER
                    window.dispatchEvent(new CustomEvent("reset-image-viewer-container"))
                }
            })
            // RESET ZOOM WHEN PRIMARY MOUSE BUTTON IS RELEASED
            container.addEventListener("mouseup", (event) => {
                state.zoom = 1
                window.dispatchEvent(new CustomEvent("reset-image-viewer-container"))
            })
            // RESET ZOOM WHEN CURSOR LEAVES THE CONTAINER
            container.addEventListener("mouseleave", (event) => {
                state.zoom = 1
                window.dispatchEvent(new CustomEvent("reset-image-viewer-container"))
            })
            // RETURN THE CONTAINER ELEMENT FOR REUSE
            return container
        }
    </script>

    <!-- COMPONENT IMAGE VIEWER CONTAINER -->
    <script>
        const ImageViewerContainer = (parent) => {
            const imageViewerContainer = document.createElement("div")
            imageViewerContainer.classList.add("image__viewer__container")
            parent.appendChild(imageViewerContainer)
            return imageViewerContainer
        }
    </script>

    <!-- COMPONENT IMAGE VIEWER -->
    <script>
        const ImageViewer = (parent) => {
            const update = () => {
                const backgroundPositionsX = state.images.map((_, index) => (index - state.idx) * 250)
                img.style.backgroundPosition = backgroundPositionsX.map(position => `${position}px 0px`).join(",")
                img.style.transform = `scale(${state.zoom})`
            }
            const img = document.createElement("div")
            img.classList.add("image__viewer")
            img.style.backgroundImage = state.images.map(image => `url(${image})`).join(",")
            img.style.backgroundRepeat = "no-repeat"
            parent.appendChild(img)
            return { img, update }
        }
    </script>

    <!-- MAIN -->
    <script>
        const body = document.body

        // INITIATE COMPONENTS
        const container = Container(body)
        const imageViewerContainer = ImageViewerContainer(container)
        const imageViewer = ImageViewer(imageViewerContainer)

        // LISTEN TO WINDOW EVENTS
        window.addEventListener("reset-image-viewer-container", () => {
            imageViewer.update()
        })
    </script>
</body>

</html>